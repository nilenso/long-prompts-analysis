<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Evolution - Claude Code vs Codex CLI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #222;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .toggle-label {
            color: #888;
            font-size: 14px;
        }
        .toggle-btn {
            background: #fff;
            border: 1px solid #ddd;
            color: #666;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .toggle-btn:hover {
            background: #f0f0f0;
            color: #333;
        }
        .toggle-btn.active {
            background: #3CB4A4;
            color: #fff;
            border-color: #3CB4A4;
            font-weight: 600;
        }
        .toggle-btn.claude.active {
            background: #E54B6B;
            border-color: #E54B6B;
        }
        .toggle-btn.codex.active {
            background: #6B9ECE;
            border-color: #6B9ECE;
        }
        .toggle-btn.compare.active {
            background: #78909C;
            border-color: #78909C;
        }
        .chart-container {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        .chart-wrapper {
            position: relative;
            height: 500px;
        }
        .legend-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 13px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background: #f0f0f0;
            color: #555;
            font-weight: 500;
        }
        td {
            color: #444;
        }
        tr:hover td {
            background: #f5f5f5;
        }
        .total-cell {
            font-weight: bold;
            color: #222;
        }
        .chart-title {
            text-align: center;
            font-size: 18px;
            color: #333;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <h1>Prompt Evolution Comparison</h1>
    <p class="subtitle">Token distribution across prompt versions</p>

    <div class="toggle-container">
        <button id="btnClaude" class="toggle-btn claude active">Claude Code</button>
        <button id="btnCodex" class="toggle-btn codex">Codex CLI</button>
        <button id="btnCompare" class="toggle-btn compare">Compare Totals</button>
    </div>

    <div class="chart-container">
        <div class="chart-title" id="chartTitle">Claude Code Prompt Evolution (May 2025 - February 2026)</div>
        <div class="chart-wrapper">
            <canvas id="mainChart"></canvas>
        </div>
        <div class="legend-container" id="customLegend"></div>
    </div>

    <div class="chart-container" id="tableContainer">
        <h2 style="margin-bottom: 15px; font-size: 18px;">Data Table</h2>
        <div style="overflow-x: auto;">
            <table id="dataTable"></table>
        </div>
    </div>

    <script>
        // ============ CLAUDE DATA ============
        const claudeData = [
            {
                "date": "2025-05-22",
                "label": "May 22 - v1.0.0 Initial",
                "totalTokens": 11884,
                "componentTokens": {
                    "Personality & Steering": 1176, "Workflow Guidance": 3535, "Code Style": 16,
                    "Tool Descriptions & Instructions": 6948, "Environment Details": 209
                }
            },
            {
                "date": "2025-07-08",
                "label": "Jul 08 - v1.0.45",
                "totalTokens": 12301,
                "componentTokens": {
                    "Personality & Steering": 1128, "Workflow Guidance": 4564, "Code Style": 16,
                    "Environment Details": 412, "Tool Descriptions & Instructions": 6181
                }
            },
            {
                "date": "2025-07-24",
                "label": "Jul 24 - v1.0.60 Plan Mode",
                "totalTokens": 12838,
                "componentTokens": {
                    "Environment Details": 21, "Workflow Guidance": 130,
                    "Personality & Steering": 2810, "Tool Descriptions & Instructions": 9877
                }
            },
            {
                "date": "2025-08-05",
                "label": "Aug 05 - v1.0.69 Opus 4.1",
                "totalTokens": 12498,
                "componentTokens": {
                    "Personality & Steering": 724, "Workflow Guidance": 3935, "Code Style": 16,
                    "Environment Details": 341, "Tool Descriptions & Instructions": 7482
                }
            },
            {
                "date": "2025-08-08",
                "label": "Aug 08 - v1.0.72 Agents",
                "totalTokens": 13022,
                "componentTokens": {
                    "Workflow Guidance": 3420, "Personality & Steering": 733, "Code Style": 16,
                    "Environment Details": 341, "Tool Descriptions & Instructions": 8512
                }
            },
            {
                "date": "2025-09-25",
                "label": "Sep 25 - v1.0.125 Pre-v2",
                "totalTokens": 13767,
                "componentTokens": {
                    "Personality & Steering": 956, "Workflow Guidance": 4805,
                    "Tool Descriptions & Instructions": 7910, "Code Style": 16, "Environment Details": 80
                }
            },
            {
                "date": "2025-09-29",
                "label": "Sep 29 - v2.0.0 Sonnet 4.5",
                "totalTokens": 12739,
                "componentTokens": {
                    "Workflow Guidance": 5887, "Code Style": 829, "Personality & Steering": 115,
                    "Environment Details": 530, "Tool Descriptions & Instructions": 5378
                }
            },
            {
                "date": "2025-10-08",
                "label": "Oct 08 - v2.0.11 Trimmed",
                "totalTokens": 12120,
                "componentTokens": {
                    "Workflow Guidance": 4757, "Code Style": 144, "Personality & Steering": 115,
                    "Tool Descriptions & Instructions": 7031, "Environment Details": 73
                }
            },
            {
                "date": "2025-10-15",
                "label": "Oct 15 - v2.0.17 Haiku 4.5",
                "totalTokens": 12436,
                "componentTokens": {
                    "Workflow Guidance": 4389, "Personality & Steering": 145, "Code Style": 223,
                    "Environment Details": 676, "Tool Descriptions & Instructions": 7003
                }
            },
            {
                "date": "2025-11-24",
                "label": "Nov 24 - v2.0.51 Opus 4.5",
                "totalTokens": 14593,
                "componentTokens": {
                    "Workflow Guidance": 5127, "Code Style": 149, "Personality & Steering": 139,
                    "Tool Descriptions & Instructions": 8918, "Environment Details": 260
                }
            },
            {
                "date": "2025-12-05",
                "label": "Dec 05 - v2.0.60",
                "totalTokens": 15065,
                "componentTokens": {
                    "Workflow Guidance": 4875, "Tool Descriptions & Instructions": 9666,
                    "Code Style": 223, "Personality & Steering": 139, "Environment Details": 162
                }
            },
            {
                "date": "2025-12-16",
                "label": "Dec 16 - v2.0.71",
                "totalTokens": 16011,
                "componentTokens": {
                    "Environment Details": 182, "Workflow Guidance": 4434, "Code Style": 201,
                    "Personality & Steering": 139, "Tool Descriptions & Instructions": 11055
                }
            },
            {
                "date": "2026-01-07",
                "label": "Jan 07 - v2.1.0 Major",
                "totalTokens": 15536,
                "componentTokens": {
                    "Workflow Guidance": 4244, "Code Style": 201, "Personality & Steering": 139,
                    "Environment Details": 148, "Tool Descriptions & Instructions": 10804
                }
            },
            {
                "date": "2026-01-13",
                "label": "Jan 13 - v2.1.6",
                "totalTokens": 16583,
                "componentTokens": {
                    "Workflow Guidance": 4159, "Code Style": 201, "Personality & Steering": 139,
                    "Environment Details": 234, "Tool Descriptions & Instructions": 11850
                }
            },
            {
                "date": "2026-01-29",
                "label": "Jan 29 - v2.1.25",
                "totalTokens": 16513,
                "componentTokens": {
                    "Personality & Steering": 149, "Environment Details": 167,
                    "Workflow Guidance": 5031, "Tool Descriptions & Instructions": 10965, "Code Style": 201
                }
            },
            {
                "date": "2026-02-05",
                "label": "Feb 05 - v2.1.32 Opus 4.6",
                "totalTokens": 16704,
                "componentTokens": {
                    "Environment Details": 254, "Workflow Guidance": 6121, "Code Style": 201,
                    "Personality & Steering": 139, "Tool Descriptions & Instructions": 9989
                }
            },
            {
                "date": "2026-02-10",
                "label": "Feb 10 - v2.1.39",
                "totalTokens": 16949,
                "componentTokens": {
                    "Environment Details": 21, "Workflow Guidance": 3158,
                    "Tool Descriptions & Instructions": 13770
                }
            }
        ];

        const claudeModelReleases = [
            { date: '2025-05-22', label: 'Opus 4 / Sonnet 4' },
            { date: '2025-08-05', label: 'Opus 4.1' },
            { date: '2025-09-29', label: 'Sonnet 4.5' },
            { date: '2025-10-15', label: 'Haiku 4.5' },
            { date: '2025-11-24', label: 'Opus 4.5' },
            { date: '2026-02-05', label: 'Opus 4.6' }
        ];

        // ============ CODEX DATA ============
        const codexData = [
            {
                "date": "2025-04-24",
                "label": "Apr 24 - Initial (Pre-GPT-5)",
                "totalTokens": 1345,
                "componentTokens": {
                    "Environment Details": 71, "Workflow Guidance": 104,
                    "Tool Descriptions & Instructions": 707, "Code Style": 412, "Personality & Steering": 51
                }
            },
            {
                "date": "2025-08-05",
                "label": "Aug 05 - Pre-GPT-5",
                "totalTokens": 2159,
                "componentTokens": {
                    "Environment Details": 324, "Workflow Guidance": 1008,
                    "Tool Descriptions & Instructions": 827
                }
            },
            {
                "date": "2025-08-07",
                "label": "Aug 07 - GPT-5",
                "totalTokens": 4997,
                "componentTokens": {
                    "Environment Details": 848, "Workflow Guidance": 2649, "Personality & Steering": 63,
                    "Code Style": 708, "Tool Descriptions & Instructions": 729
                }
            },
            {
                "date": "2025-09-14",
                "label": "Sep 14 - GPT-5-Codex (Swiftfox)",
                "totalTokens": 2166,
                "componentTokens": {
                    "Personality & Steering": 22, "Workflow Guidance": 773,
                    "Tool Descriptions & Instructions": 61, "Environment Details": 713, "Code Style": 597
                }
            },
            {
                "date": "2025-11-12",
                "label": "Nov 12 - GPT-5.1",
                "totalTokens": 5098,
                "componentTokens": {
                    "Environment Details": 855, "Workflow Guidance": 3010, "Personality & Steering": 63,
                    "Code Style": 869, "Tool Descriptions & Instructions": 301
                }
            },
            {
                "date": "2025-11-18",
                "label": "Nov 18 - GPT-5.1-Codex-Max (Arcticfox)",
                "totalTokens": 2483,
                "componentTokens": {
                    "Environment Details": 28, "Workflow Guidance": 576,
                    "Tool Descriptions & Instructions": 921, "Personality & Steering": 198, "Code Style": 760
                }
            },
            {
                "date": "2025-12-11",
                "label": "Dec 11 - GPT-5.2 (Robin)",
                "totalTokens": 6018,
                "componentTokens": {
                    "Environment Details": 1013, "Workflow Guidance": 4343, "Personality & Steering": 63,
                    "Tool Descriptions & Instructions": 599
                }
            },
            {
                "date": "2025-12-18",
                "label": "Dec 18 - GPT-5.2-Codex (Caribou)",
                "totalTokens": 2474,
                "componentTokens": {
                    "Environment Details": 28, "Workflow Guidance": 880,
                    "Tool Descriptions & Instructions": 912, "Personality & Steering": 198, "Code Style": 456
                }
            },
            {
                "date": "2026-02-05",
                "label": "Feb 05 - GPT-5.3-Codex",
                "totalTokens": 2526,
                "componentTokens": {
                    "Personality & Steering": 369, "Tool Descriptions & Instructions": 103,
                    "Workflow Guidance": 1459, "Code Style": 595
                }
            }
        ];

        const codexModelReleases = [
            { date: '2025-08-07', label: 'GPT-5' },
            { date: '2025-09-15', label: 'GPT-5-Codex' },
            { date: '2025-11-19', label: 'GPT-5.1-Codex-Max' },
            { date: '2025-12-11', label: 'GPT-5.2' },
            { date: '2025-12-18', label: 'GPT-5.2-Codex' },
            { date: '2026-02-05', label: 'GPT-5.3' }
        ];

        const colors = {
            'Code Style': '#6B9ECE',
            'Environment Details': '#3CB4A4',
            'Personality & Steering': '#E54B6B',
            'Tool Descriptions & Instructions': '#78909C',
            'Workflow Guidance': '#F4A156',
            'Other': '#9CA3AF'
        };

        const components = ['Code Style', 'Environment Details', 'Personality & Steering', 'Tool Descriptions & Instructions', 'Workflow Guidance'];

        const claudeSimplified = claudeData;
        const codexSimplified = codexData;

        // Chart instance
        let chart = null;
        let currentView = 'claude';

        // Build annotations
        function buildAnnotations(releases, color) {
            const annotations = {};
            releases.forEach((release, i) => {
                annotations[`line${i}`] = {
                    type: 'line',
                    xMin: release.date,
                    xMax: release.date,
                    borderColor: color,
                    borderWidth: 2,
                    borderDash: [6, 4],
                    label: {
                        display: true,
                        content: release.label,
                        position: 'start',
                        backgroundColor: color + 'CC',
                        color: '#fff',
                        font: { size: 10, weight: 'bold' },
                        padding: 3,
                        yAdjust: -10
                    }
                };
            });
            return annotations;
        }

        // Build stacked datasets
        function buildStackedDatasets(data) {
            const datasets = components.map((comp) => ({
                label: comp,
                data: data.map(d => ({ x: d.date, y: d.componentTokens[comp] || 0 })),
                backgroundColor: colors[comp],
                borderColor: colors[comp],
                borderWidth: 1,
                fill: true,
                tension: 0,
                pointRadius: 4,
                pointHoverRadius: 6,
                stack: 'components'
            }));

            datasets.push({
                label: 'Total Tokens',
                data: data.map(d => ({ x: d.date, y: d.totalTokens })),
                backgroundColor: 'transparent',
                borderColor: '#333333',
                borderWidth: 3,
                borderDash: [5, 5],
                fill: false,
                tension: 0,
                pointRadius: 6,
                pointHoverRadius: 8,
                pointBackgroundColor: '#333333',
                stack: 'total',
                order: -1
            });

            return datasets;
        }

        // Build comparison datasets
        function buildCompareDatasets() {
            return [
                {
                    label: 'Claude Code',
                    data: claudeSimplified.map(d => ({ x: d.date, y: d.totalTokens })),
                    backgroundColor: 'transparent',
                    borderColor: '#E54B6B',
                    borderWidth: 3,
                    fill: false,
                    tension: 0,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    pointBackgroundColor: '#E54B6B'
                },
                {
                    label: 'Codex CLI',
                    data: codexSimplified.map(d => ({ x: d.date, y: d.totalTokens })),
                    backgroundColor: 'transparent',
                    borderColor: '#6B9ECE',
                    borderWidth: 3,
                    fill: false,
                    tension: 0,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    pointBackgroundColor: '#6B9ECE'
                }
            ];
        }

        // Build combined annotations for compare view
        function buildCombinedAnnotations() {
            const annotations = {};
            claudeModelReleases.forEach((release, i) => {
                annotations[`claude${i}`] = {
                    type: 'line',
                    xMin: release.date,
                    xMax: release.date,
                    borderColor: '#E54B6B',
                    borderWidth: 2,
                    borderDash: [6, 4],
                    label: {
                        display: true,
                        content: release.label,
                        position: 'start',
                        backgroundColor: '#E54B6BCC',
                        color: '#fff',
                        font: { size: 9, weight: 'bold' },
                        padding: 2,
                        yAdjust: -10
                    }
                };
            });
            codexModelReleases.forEach((release, i) => {
                annotations[`codex${i}`] = {
                    type: 'line',
                    xMin: release.date,
                    xMax: release.date,
                    borderColor: '#6B9ECE',
                    borderWidth: 2,
                    borderDash: [6, 4],
                    label: {
                        display: true,
                        content: release.label,
                        position: 'end',
                        backgroundColor: '#6B9ECECC',
                        color: '#fff',
                        font: { size: 9, weight: 'bold' },
                        padding: 2,
                        yAdjust: 10
                    }
                };
            });
            return annotations;
        }

        // Create chart
        function createChart(view) {
            if (chart) chart.destroy();

            const ctx = document.getElementById('mainChart').getContext('2d');
            let datasets, annotations, title;

            if (view === 'claude') {
                datasets = buildStackedDatasets(claudeSimplified);
                annotations = buildAnnotations(claudeModelReleases, '#E54B6B');
                title = 'Claude Code Prompt Evolution (May 2025 - February 2026)';
            } else if (view === 'codex') {
                datasets = buildStackedDatasets(codexSimplified);
                annotations = buildAnnotations(codexModelReleases, '#6B9ECE');
                title = 'Codex CLI Prompt Evolution (April 2025 - February 2026)';
            } else {
                datasets = buildCompareDatasets();
                annotations = buildCombinedAnnotations();
                title = 'Total Tokens Comparison: Claude Code vs Codex CLI';
            }

            document.getElementById('chartTitle').textContent = title;

            chart = new Chart(ctx, {
                type: 'line',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#fff',
                            titleColor: '#222',
                            bodyColor: '#444',
                            borderColor: '#ddd',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                title: function(context) {
                                    if (view === 'compare') return context[0].raw.x;
                                    const data = view === 'claude' ? claudeSimplified : codexSimplified;
                                    const idx = data.findIndex(d => d.date === context[0].raw.x);
                                    return idx >= 0 ? data[idx].label : context[0].label;
                                },
                                label: function(context) {
                                    const val = context.raw.y;
                                    if (val === 0) return null;
                                    return `${context.dataset.label}: ${val.toLocaleString()} tokens`;
                                }
                            }
                        },
                        annotation: { annotations }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: { unit: 'month', displayFormats: { month: 'MMM yyyy' } },
                            grid: { color: '#e0e0e0' },
                            ticks: { color: '#666' }
                        },
                        y: {
                            stacked: view !== 'compare',
                            grid: { color: '#e0e0e0' },
                            ticks: { color: '#666', callback: v => v.toLocaleString() },
                            title: { display: true, text: 'Tokens', color: '#666' }
                        }
                    }
                }
            });

            updateLegend(view);
            updateTable(view);
            currentView = view;
        }

        // Update legend
        function updateLegend(view) {
            const container = document.getElementById('customLegend');
            if (view === 'compare') {
                container.innerHTML = `
                    <div class="legend-item">
                        <div class="legend-color" style="background: #E54B6B;"></div>
                        <span>Claude Code</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #6B9ECE;"></div>
                        <span>Codex CLI</span>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="legend-item">
                        <div class="legend-color" style="background: #333; border: 2px dashed #333;"></div>
                        <span>Total Tokens</span>
                    </div>
                `;
                components.forEach(comp => {
                    container.innerHTML += `
                        <div class="legend-item">
                            <div class="legend-color" style="background: ${colors[comp]};"></div>
                            <span>${comp}</span>
                        </div>
                    `;
                });
            }
        }

        // Update table
        function updateTable(view) {
            const table = document.getElementById('dataTable');
            const tableContainer = document.getElementById('tableContainer');

            if (view === 'compare') {
                tableContainer.style.display = 'none';
                return;
            }

            tableContainer.style.display = 'block';
            const data = view === 'claude' ? claudeSimplified : codexSimplified;

            let html = '<thead><tr><th>Version</th><th>Total</th>';
            components.forEach(c => html += `<th>${c}</th>`);
            html += '</tr></thead><tbody>';

            data.forEach(d => {
                html += `<tr><td>${d.label}</td><td class="total-cell">${d.totalTokens.toLocaleString()}</td>`;
                components.forEach(c => {
                    const val = d.componentTokens[c] || 0;
                    html += `<td>${val > 0 ? val.toLocaleString() : '-'}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        // Toggle handlers
        document.getElementById('btnClaude').addEventListener('click', function() {
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            createChart('claude');
        });

        document.getElementById('btnCodex').addEventListener('click', function() {
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            createChart('codex');
        });

        document.getElementById('btnCompare').addEventListener('click', function() {
            document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            createChart('compare');
        });

        // Initialize
        createChart('claude');
    </script>
</body>
</html>
